<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>Deflect: Stereo Streaming</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Deflect
   &#160;<span id="projectnumber">1.0.0</span>
   </div>
   <div id="projectbrief">A fast C++ library for streaming pixels and events</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('md__jenkins_04_workspace_oss.Deflect.documentation_build_type_Debug_platform_cscsviz-vm_sources_doc_StereoStreaming.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Stereo Streaming </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This document describes the stereo streaming support introduced in Deflect 0.13.</p>
<h2>Requirements</h2>
<ul>
<li>Simple extension of the monoscopic Stream API</li>
<li>No network protocol changes that break current Deflect clients or servers</li>
<li>Support both screen space decompostion (sort-first) and left-right stereo decomposition modes for distributed rendering.</li>
</ul>
<div class="image">
<img src="stereo.png" alt="stereo.png"/>
<div class="caption">
Stereo streaming overview</div></div>
 <h2>API</h2>
<p>New view enum in <a class="el" href="types_8h_source.html">deflect/types.h</a>: </p><pre class="fragment">enum class View : std::int8_t { mono, left_eye, right_eye };
</pre><p>The ImageWrapper takes an additional View parameter.</p>
<p>API changes to the Stream class:</p><ul>
<li>asyncSend is renamed to sendAndFinish, asyncSend forwards and is deprecated</li>
<li>send and finish are now asynchronous and return a future instead of bool</li>
</ul>
<p>The send operation sends one tile of one eye pass to the server. The finishFrame operation completes the whole frame for all eye passes, that is, send is analogous to an OpenGL draw pass (GL_BACK, GL_BACK_LEFT, GL_BACK_RIGHT), and finishFrame is analogous to a swap buffer call, with the extension that all client's finish is synchronized by the server.</p>
<p>On the server side, no changes to the Server API (except some cleanups). Each Segment dispatched now with a Frame contains the View information. A frame is considered complete when all connected clients have send a finish.</p>
<h2>Protocol</h2>
<p>The Stream send an additional View information message before each image payload. This message is silently ignored by older Servers.</p>
<h2>Examples</h2>
<p>Example of a stereo 3D client application using synchronous operations: </p><pre class="fragment">deflect::Stream stream( ... );

/** ...synchronize start with other render clients (network barrier)... */

renderLoop()
{
/** ...render left image... */

deflect::ImageWrapper leftImage( data, width, height, deflect::RGBA );
leftImage.view = deflect::View::left_eye;
deflectStream-&gt;send( leftImage ).wait();

/** ...render right image... */

deflect::ImageWrapper rightImage( data, width, height, deflect::RGBA );
rightImage.view = deflect::View::right_eye;
deflectStream-&gt;send( rightImage ).wait();

deflectStream-&gt;finishFrame().wait();

/** ...synchronize with other render clients (network barrier)... */
}
</pre><p>Example of a stereo 3D client application using the asynchronous operations: </p><pre class="fragment">deflect::Stream stream( ... );

/** ...synchronize start with other render clients (network barrier)... */
std::vector&lt; std::future&lt; bool &gt;&gt; futures;
renderLoop()
{
for( auto&amp; future : futures )
    if( !future.get( ))
        return;
futures.clear();

/** ...render left image... */

deflect::ImageWrapper leftImage( leftData, width, height, deflect::RGBA );
leftImage.view = deflect::View::left_eye;
futures.emplace_back( deflectStream-&gt;send( leftImage ));

/** ...render right image... */

deflect::ImageWrapper rightImage( rightData, width, height, deflect::RGBA );
rightImage.view = deflect::View::right_eye;
futures.emplace_back( deflectStream-&gt;send( rightImage ));

futures.emplace_back( deflectStream-&gt;finishFrame( ));

/** ...synchronize with other render clients (network barrier)... */
}
</pre><p>For a complete code example, please refer to the SimpleStreamer application.</p>
<h2>Issues</h2>
<h3>1: Should clients be notified if they attempt to stream stereo content to a server which can only handle monoscopic content?</h3>
<p><em>Resolution: Not yet:</em> For legacy implementation reasons, it is not possible to send information from the Server to the Stream about the capabilities of the server (such as stereo support) without rejecting all clients based on Deflect &lt; 0.12.1. A transition period is required before implementing this feature. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Sat May 5 2018 02:30:17 for Deflect by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.11 </li>
  </ul>
</div>
</body>
</html>
