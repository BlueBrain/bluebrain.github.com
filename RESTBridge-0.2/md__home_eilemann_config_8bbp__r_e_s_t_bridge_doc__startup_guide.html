<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>RESTBridge: Start-up Guide</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">RESTBridge
   &#160;<span id="projectnumber">0.2.0</span>
   </div>
   <div id="projectbrief">A library that provides a simple way to expose a REST interface in a C++ application</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('md__home_eilemann_config_8bbp__r_e_s_t_bridge_doc__startup_guide.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Start-up Guide </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#Introduction">Introduction</a></li>
<li class="level1"><a href="#Tutorial">Tutorial</a><ul><li class="level2"><a href="#HeartBeatEvent">HeartBeat event</a></li>
<li class="level2"><a href="#VocabularyEvent">Vocabulary event</a></li>
<li class="level2"><a href="#CameraEvent">Camera event</a></li>
<li class="level2"><a href="#ImageJpegEvent">ImageJPEG event</a></li>
<li class="level2"><a href="#ZeroEQHandlers">ZeroEQ Handlers</a></li>
<li class="level2"><a href="#RESTBridgeServer">RESTBridge Server</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="Introduction"></a>
Introduction</h1>
<p>This page is a startup guide for any C++ developer willing to make its application available on the web. A step by step tutorial illustrates the definition and implementation of application specific features that will easily be accessed through a REST interface.</p>
<h1><a class="anchor" id="Tutorial"></a>
Tutorial</h1>
<h2><a class="anchor" id="HeartBeatEvent"></a>
HeartBeat event</h2>
<p>The heart-beat event is sent on a regular bases to inform the RESTBridge that the rendering resource is running and ready to process requests. When the RESTBridge receives the first heart-beat event from the rendering resource, the vocabulary available in the rendering resource is requested and made available to the user-end web application. The RESTBridge will keep on returning 501 HTTP errors (Resource not available) to the user-end web application until the rendering resource vocabulary is registered.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;zeq/zeq.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;zeq/hbp/hbp.h&gt;</span></div>
<div class="line"><span class="preprocessor">#define DEFAULT_HEARTBEAT_TIME 1000.0f</span></div>
<div class="line"><span class="preprocessor"></span>lunchbox::Clock heartbeatClock;</div>
<div class="line">...</div>
<div class="line"><span class="comment">// In this example, the rendering resource is constantly rendering,</span></div>
<div class="line"><span class="comment">// and the following code is executed for every frame.</span></div>
<div class="line">if( heartbeatClock.getTimef() &gt;= DEFAULT_HEARTBEAT_TIME )</div>
<div class="line">{</div>
<div class="line">    heartbeatClock.reset();</div>
<div class="line">    publisher.publish( zeq::Event( zeq::vocabulary::EVENT_HEARTBEAT ) );</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="VocabularyEvent"></a>
Vocabulary event</h2>
<p>The vocabulary event is used to register the commands that are supported by the rendering resource. The rendering resource can publish this event at any time to inform the RESTBridge of any changes in its functionalities. There are two types of events:</p>
<ul>
<li>Publisher: An event that is emitted by the rendering resource.</li>
<li>Subscriber: An event that is received by the rendering resource.</li>
</ul>
<p>As an example, a ChangeBackgroundColor event would be a subscriber, and an ImageJPEG event a publisher. If an event can be both a subscriber and a publisher, then it should be registered twice.</p>
<p>A vocabulary event contains the entire list of supported events and completely replaces any existing registration. In other words, any event that is not listed in the vocabulary is removed from the RESTBridge internal maps, even it was previously registered by another vocabulary event. The following code snippet illustrates the use of the vocabulary event to register ImageJPEG and Camera events.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;zeq/zeq.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;zeq/hbp/hbp.h&gt;</span></div>
<div class="line"><span class="comment">// Declare vocabulary</span></div>
<div class="line">zeq::EventDescriptors vocabulary;</div>
<div class="line"><span class="comment">// Add ImageJPEG event to vocabulary</span></div>
<div class="line">vocabulary.push_back( zeq::EventDescriptor( zeq::hbp::IMAGEJPEG,</div>
<div class="line">                                            zeq::hbp::EVENT_IMAGEJPEG,</div>
<div class="line">                                            zeq::hbp::SCHEMA_IMAGEJPEG,</div>
<div class="line">                                            zeq::PUBLISHER ) );</div>
<div class="line"><span class="comment">// Add CAMERA event to vocabulary</span></div>
<div class="line">vocabulary.push_back( zeq::EventDescriptor( zeq::hbp::CAMERA,</div>
<div class="line">                        zeq::hbp::EVENT_CAMERA,</div>
<div class="line">                        zeq::hbp::SCHEMA_CAMERA, </div>
<div class="line">                        zeq::SUBSCRIBER ) );</div>
<div class="line"><span class="comment">// Publish vocabulary to RESTBridge</span></div>
<div class="line"><span class="keyword">const</span> zeq::Event&amp; vocEvent = </div>
<div class="line">    zeq::vocabulary::serializeVocabulary( vocabulary );</div>
<div class="line">publisher.publish( vocEvent );</div>
</div><!-- fragment --><h2><a class="anchor" id="CameraEvent"></a>
Camera event</h2>
<p>The camera event is defined by a 4x4 matrix, with values defined in microns. The FlatBuffers definition of the event is the following:</p>
<div class="fragment"><div class="line"><span class="keyword">namespace </span>zeq.hbp;</div>
<div class="line">table Camera</div>
<div class="line">{</div>
<div class="line">    matrix:[float];</div>
<div class="line">}</div>
<div class="line">root_type Camera;</div>
</div><!-- fragment --><h2><a class="anchor" id="ImageJpegEvent"></a>
ImageJPEG event</h2>
<p>The ImageJPEG event is defined by an array of bytes containing a 32bit BGRA image. The FlatBuffers definition of the event is the following:</p>
<div class="fragment"><div class="line"><span class="keyword">namespace </span>zeq.hbp;</div>
<div class="line">table ImageJPEG</div>
<div class="line">{</div>
<div class="line">    data:[ubyte];</div>
<div class="line">}</div>
<div class="line">root_type ImageJPEG;</div>
</div><!-- fragment --><p>Here is a simple example of how to generate and publish the event in the rendering resource application code:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;zeq/zeq.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;zeq/hbp/hbp.h&gt;</span></div>
<div class="line"><span class="keyword">const</span> uint8_t* dataPtr = ...; <span class="comment">// Buffer containing the JPEG image bytes</span></div>
<div class="line"><span class="keyword">const</span> uint64_t dataSize = ...; <span class="comment">// Buffer size</span></div>
<div class="line"><span class="keyword">const</span> zeq::hbp::data::ImageJPEG image( dataSize, dataPtr );</div>
<div class="line"><span class="keyword">const</span> zeq::Event&amp; image_event = zeq::hbp::serializeImageJPEG( image );</div>
<div class="line">publisher.publish( image_event );</div>
</div><!-- fragment --><h2><a class="anchor" id="ZeroEQHandlers"></a>
ZeroEQ Handlers</h2>
<p>For every ZeroEQ event supported by the C++ application, a handler must be defined and registered. A Handler is a class method that implements the code related to the ZeroEQ event. The following example illustrates the registering of the MyApplication::onCamera method that takes care of the ZeroEQ Camera event.</p>
<div class="fragment"><div class="line">subscriber_ = <span class="keyword">new</span> zeq::Subscriber(servus::URI( zeqSchema_ + <span class="stringliteral">&quot;cmd://&quot;</span> ));</div>
<div class="line">subscriber_-&gt;registerHandler( zeq::hbp::EVENT_CAMERA,</div>
<div class="line">boost::bind( &amp;MyApplication::onCamera, <span class="keyword">this</span> , _1 ));</div>
</div><!-- fragment --><h2><a class="anchor" id="RESTBridgeServer"></a>
RESTBridge Server</h2>
<p>The RestBridge class implements the http server and starts a dedicated thread on the host and port specified in the class constructor. HTTP requests addressed to the HTTP server is transformed into a ZeroEQ event, according to the registered vocabulary. Only GET requests expect a ZeroEQ event in return. If the HTTP request contains a unknown command (not registered in the vocabulary), a BAD_REQUEST (HTTP 400) error is returned.</p>
<div class="fragment"><div class="line"><a class="code" href="classrestbridge_1_1_rest_bridge.html">restbridge::RestBridge</a> mainServer(<span class="stringliteral">&quot;localhost&quot;</span>, 3000);</div>
<div class="line">mainServer.run(<span class="stringliteral">&quot;restSchema&quot;</span>);</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Fri Oct 23 2015 13:56:22 for RESTBridge by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.6 </li>
  </ul>
</div>
</body>
</html>
