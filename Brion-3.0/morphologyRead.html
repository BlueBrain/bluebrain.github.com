<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>Brion: Modification of the brion::Morphology read API</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Brion
   &#160;<span id="projectnumber">3.0.0</span>
   </div>
   <div id="projectbrief">The Blue Brain C++ I/O library</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('morphologyRead.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Modification of the <a class="el" href="classbrion_1_1_morphology.html" title="Read access a Morphology file. ">brion::Morphology</a> read API </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2>Motivation</h2>
<p>The current read API is incorrect. It does return a shared_ptr to mutable data, but is marked const. For example, the brain::Morphology takes a const <a class="el" href="classbrion_1_1_morphology.html" title="Read access a Morphology file. ">brion::Morphology</a>&amp;, but the given object is modified in case of SWC with global transformation.</p>
<h2>API variants:</h2>
<p>We chose option 5 since it clarifies and unifies the behaviour of all plugins with a clean API:</p>
<ol type="1">
<li>ConstVectorPtr readFoo() const</li>
<li>Vector readFoo() const</li>
<li>VectorPtr readFoo()</li>
<li>std::future&lt;Vector&gt; readFoo() const</li>
<li>Vector&amp; getFoo() and const Vector&amp; getFoo() const</li>
</ol>
<p>Some implementations do read multiple vectors at the same time (SWC, ZeroEQ).</p>
<p>Option 1 is rejected: Client code always needs to make a copy if it wants to modify the data.</p>
<p>Option 2 either complicates the implementation of SWC/ZeroEQ which need to reread data if a given read function is called multiple times, or would constrain the API to throw if a read function is called multiple times.</p>
<p>Option 3 is awkward since it is a mutable read API, and delays the problem to the user of the API.</p>
<p>Option 4 adds the future complexity (with shared state between readFoo/readBar) on top of Option 2.</p>
<p>Option 5 parses always the data in the ctor using a future and thread pool synchronized in all getFoo() calls. This forces that the <a class="el" href="classbrion_1_1_morphology.html" title="Read access a Morphology file. ">brion::Morphology</a> has state and data, and we should remove the write API at the same time. It has the disadvantage of loading all data deferred from the ctor, which requires out of core loading (or batching) for large amounts of morphologies. Client code using the brain API already has this constraint. While this seems to be more complex, actual plugin implementations become simpler since all of the threading and synchronization will be done in the plugin base class. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="rfcs.html">RFCs</a></li>
    <li class="footer">Generated on Sat Jun 16 2018 06:16:07 for Brion by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.11 </li>
  </ul>
</div>
</body>
</html>
