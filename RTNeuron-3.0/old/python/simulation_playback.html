<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Simulation playback &mdash; RTNeuron 3.0 Python API documentation</title>
    
    <link rel="stylesheet" href="_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '3.0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="RTNeuron 3.0 Python API documentation" href="index.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">RTNeuron 3.0 Python API documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="simulation-playback">
<span id="id1"></span><h1>Simulation playback<a class="headerlink" href="#simulation-playback" title="Permalink to this headline">Â¶</a></h1>
<p>We start displaying the 600 center cells of the circuit. Notice that
<code class="docutils literal"><span class="pre">display_circuit</span></code> accepts regular expressions.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">rtneuron</span>
<span class="kn">import</span> <span class="nn">brain</span>

<span class="c1"># Presetting the global variables for the default window size</span>
<span class="n">rtneuron</span><span class="o">.</span><span class="n">global_attributes</span><span class="o">.</span><span class="n">window_width</span> <span class="o">=</span> <span class="mi">800</span>
<span class="n">rtneuron</span><span class="o">.</span><span class="n">global_attributes</span><span class="o">.</span><span class="n">window_height</span> <span class="o">=</span> <span class="mi">1100</span>

<span class="c1"># Creating the attributes for the neuron set that will be displayed</span>
<span class="n">attributes</span> <span class="o">=</span> <span class="n">rtneuron</span><span class="o">.</span><span class="n">AttributeMap</span><span class="p">()</span>
<span class="n">attributes</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">rtneuron</span><span class="o">.</span><span class="n">RepresentationMode</span><span class="o">.</span><span class="n">SOMA</span>
<span class="c1"># Displaying the circuit</span>
<span class="n">rtneuron</span><span class="o">.</span><span class="n">display_circuit</span><span class="p">(</span><span class="n">brain</span><span class="o">.</span><span class="n">test</span><span class="o">.</span><span class="n">blue_config</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;MiniColumn_[0-5]&#39;</span><span class="p">,</span> <span class="n">attributes</span><span class="p">))</span>

<span class="n">view</span> <span class="o">=</span> <span class="n">rtneuron</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">views</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">view</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">background</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]</span>
<span class="n">view</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">setView</span><span class="p">([</span><span class="mi">60</span><span class="p">,</span> <span class="mi">760</span><span class="p">,</span> <span class="mi">1760</span><span class="p">],</span> <span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span> <span class="mf">0.0</span><span class="p">))</span>
<span class="c1"># Make sure the camera is not modified after scene modifications.</span>
<span class="n">view</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">auto_compute_home_position</span> <span class="o">=</span> <span class="bp">False</span>

<span class="n">scene</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">scene</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span></span>Trying to load blue config: /home/hernando/dev/Debug/BBPTestData/local/simulations/may17_2011/Control/BlueConfig... done
Creating 600 neurons
0%   10   20   30   40   50   60   70   80   90   100%
|----|----|----|----|----|----|----|----|----|----|
***************************************************
Adding 600 neurons to the scene
0%   10   20   30   40   50   60   70   80   90   100%
|----|----|----|----|----|----|----|----|----|----|
***************************************************
</pre></div>
</div>
<p>There are two types of simulation data:</p>
<ul class="simple">
<li>Spike time traces, where each spike is a discrete event defined by a
timestamp and a cell identifier.</li>
<li>Reports of continuous scalar variables on the neuron membrane measured, aka
compartment reports. These data are reported for a discretization of the
morphological skeleton where each piece is called a compartment.</li>
</ul>
<p>At somas it&#8217;s possible to visualize them as a color shift that is
triggered at the spike time and decays gradually to the color used for
the inactive state. To apply spike data on the scene there&#8217;s a helper
function that simplifies the process.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="c1"># The input parameters can also be a file with spike times (.gdf or BBP .out) and a scene.</span>
<span class="c1"># When a scene is used, simulation display has to be enabled explicitly on the view.</span>
<span class="n">rtneuron</span><span class="o">.</span><span class="n">apply_spike_data</span><span class="p">(</span><span class="n">rtneuron</span><span class="o">.</span><span class="n">simulation</span><span class="p">,</span> <span class="n">view</span><span class="p">)</span>
<span class="n">player</span> <span class="o">=</span> <span class="n">rtneuron</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">player</span>
<span class="n">player</span><span class="o">.</span><span class="n">timestamp</span> <span class="o">=</span> <span class="mi">8</span>
<span class="n">rtneuron</span><span class="o">.</span><span class="n">snapshot_to_notebook</span><span class="p">(</span><span class="n">view</span><span class="p">)</span>
</pre></div>
</div>
<img alt="_images/simulation_playback_3_0.png" src="_images/simulation_playback_3_0.png" />
<p>It&#8217;s possible to assign a different colormap to different neuron
subsets. This allows, for example, to use different colors to highlight
spikes of excitatory and inhibitory neurons.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="n">all_neurons</span> <span class="o">=</span> <span class="n">scene</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">apply_spike_colormap_to_cells</span><span class="p">(</span><span class="n">set_name</span><span class="p">,</span> <span class="n">color</span><span class="p">):</span>
    <span class="n">colormap</span> <span class="o">=</span> <span class="n">rtneuron</span><span class="o">.</span><span class="n">ColorMap</span><span class="p">()</span>
    <span class="n">colormap</span><span class="o">.</span><span class="n">setPoints</span><span class="p">({</span><span class="mi">0</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">:</span> <span class="n">color</span><span class="p">})</span>
    <span class="n">subset</span> <span class="o">=</span> <span class="n">all_neurons</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">rtneuron</span><span class="o">.</span><span class="n">simulation</span><span class="o">.</span><span class="n">gids</span><span class="p">(</span><span class="n">set_name</span><span class="p">))</span>
    <span class="c1"># Colormaps are assigned into a nested AttributeMap called &#39;colormaps&#39;.</span>
    <span class="c1"># This attribute is not defined by default, we have to create it.</span>
    <span class="n">subset</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">colormaps</span> <span class="o">=</span> <span class="n">rtneuron</span><span class="o">.</span><span class="n">AttributeMap</span><span class="p">()</span>
    <span class="c1"># The colormap for spike data is called &#39;spikes&#39;</span>
    <span class="n">subset</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">colormaps</span><span class="o">.</span><span class="n">spikes</span> <span class="o">=</span> <span class="n">colormap</span>
    <span class="n">subset</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">subset</span>

<span class="n">excitatory</span> <span class="o">=</span> <span class="n">apply_spike_colormap_to_cells</span><span class="p">(</span><span class="s1">&#39;Excitatory&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">inhibitory</span> <span class="o">=</span> <span class="n">apply_spike_colormap_to_cells</span><span class="p">(</span><span class="s1">&#39;Inhibitory&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>

<span class="n">rtneuron</span><span class="o">.</span><span class="n">sceneops</span><span class="o">.</span><span class="n">enable_transparency</span><span class="p">(</span><span class="n">scene</span><span class="p">)</span>
<span class="n">rtneuron</span><span class="o">.</span><span class="n">snapshot_to_notebook</span><span class="p">(</span><span class="n">view</span><span class="p">)</span>
</pre></div>
</div>
<img alt="_images/simulation_playback_5_0.png" src="_images/simulation_playback_5_0.png" />
<p>Simulation playback can be controlled from the <em>engine.player</em> object.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="n">player</span><span class="o">.</span><span class="n">timestamp</span> <span class="o">=</span> <span class="n">player</span><span class="o">.</span><span class="n">window</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">view</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">spike_tail</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">player</span><span class="o">.</span><span class="n">simulationDelta</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">player</span><span class="o">.</span><span class="n">play</span><span class="p">()</span>
</pre></div>
</div>
<p>Another helper functions simplifies the process of applying a
compartment report to the scene. For somas, if both spike and
compartment data have been applied, compartment data takes precedence.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="n">player</span><span class="o">.</span><span class="n">pause</span><span class="p">()</span>
<span class="n">rtneuron</span><span class="o">.</span><span class="n">apply_compartment_report</span><span class="p">(</span><span class="n">rtneuron</span><span class="o">.</span><span class="n">simulation</span><span class="p">,</span> <span class="n">view</span><span class="p">,</span> <span class="s1">&#39;voltage&#39;</span><span class="p">)</span>
<span class="n">player</span><span class="o">.</span><span class="n">timestamp</span> <span class="o">=</span> <span class="mf">7.6</span>
<span class="n">rtneuron</span><span class="o">.</span><span class="n">snapshot_to_notebook</span><span class="p">(</span><span class="n">view</span><span class="p">)</span>
</pre></div>
</div>
<img alt="_images/simulation_playback_9_0.png" src="_images/simulation_playback_9_0.png" />
<p>At any moment we can change the representation mode of some neurons to
use detailed morphologies. We will do it for the center minicolumn.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="n">minicolumn</span> <span class="o">=</span> <span class="n">all_neurons</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">rtneuron</span><span class="o">.</span><span class="n">simulation</span><span class="o">.</span><span class="n">gids</span><span class="p">(</span><span class="s1">&#39;L5CSPC&#39;</span><span class="p">))</span>
<span class="n">minicolumn</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">rtneuron</span><span class="o">.</span><span class="n">RepresentationMode</span><span class="o">.</span><span class="n">WHOLE_NEURON</span>
<span class="n">minicolumn</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
<span class="c1"># When spike data has been provided, the axon shows the propagation of the action potentials using a</span>
<span class="c1"># constant (hardcoded) speed. Since the spike fall-off time (spike_tail view attribute) was modified</span>
<span class="c1"># before, we set here a more reasonable value.</span>
<span class="n">view</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">spike_tail</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">player</span><span class="o">.</span><span class="n">timestamp</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">rtneuron</span><span class="o">.</span><span class="n">snapshot_to_notebook</span><span class="p">(</span><span class="n">view</span><span class="p">)</span>
</pre></div>
</div>
<img alt="_images/simulation_playback_11_0.png" src="_images/simulation_playback_11_0.png" />
<p>Colormaps for compartment data can also be applied on a circuit subset
basis. The following code takes the default colormap and converts it to
a black &amp; white colormap for the soma only neurons</p>
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">to_grayscale</span><span class="p">(</span><span class="n">color</span><span class="p">,</span> <span class="n">alpha_factor</span><span class="p">):</span>
    <span class="n">v</span> <span class="o">=</span> <span class="mf">0.21</span> <span class="o">*</span> <span class="n">color</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.72</span> <span class="o">*</span> <span class="n">color</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.07</span> <span class="o">*</span> <span class="n">color</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">color</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="n">alpha_factor</span><span class="p">)</span>

<span class="n">global_colormap</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">colormaps</span><span class="o">.</span><span class="n">compartments</span>

<span class="n">original</span> <span class="o">=</span> <span class="n">rtneuron</span><span class="o">.</span><span class="n">ColorMap</span><span class="p">()</span>
<span class="n">original</span><span class="o">.</span><span class="n">setPoints</span><span class="p">(</span><span class="n">global_colormap</span><span class="o">.</span><span class="n">getPoints</span><span class="p">())</span>

<span class="n">points</span> <span class="o">=</span> <span class="p">{</span><span class="n">value</span><span class="p">:</span> <span class="n">to_grayscale</span><span class="p">(</span><span class="n">color</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">)</span>
          <span class="k">for</span> <span class="n">value</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="n">original</span><span class="o">.</span><span class="n">getPoints</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

<span class="n">global_colormap</span><span class="o">.</span><span class="n">setPoints</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>

<span class="n">minicolumn</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">colormaps</span> <span class="o">=</span> <span class="n">rtneuron</span><span class="o">.</span><span class="n">AttributeMap</span><span class="p">()</span>
<span class="n">minicolumn</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">colormaps</span><span class="o">.</span><span class="n">compartments</span> <span class="o">=</span> <span class="n">original</span>
<span class="n">minicolumn</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
<span class="n">rtneuron</span><span class="o">.</span><span class="n">snapshot_to_notebook</span><span class="p">(</span><span class="n">view</span><span class="p">)</span>
</pre></div>
</div>
<img alt="_images/simulation_playback_13_0.png" src="_images/simulation_playback_13_0.png" />
<p>The alpha channel of the colors can be modulated by the static coloring
scheme. At the moment the only possible modification is its
multiplication by the alpha channel defined by the static coloring.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">math</span>

<span class="n">minicolumn</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">color_scheme</span> <span class="o">=</span> <span class="n">rtneuron</span><span class="o">.</span><span class="n">ColorScheme</span><span class="o">.</span><span class="n">BY_WIDTH</span>
<span class="n">colormap</span> <span class="o">=</span> <span class="n">rtneuron</span><span class="o">.</span><span class="n">ColorMap</span><span class="p">()</span>
<span class="c1"># The actual colors aren&#39;t important is the alpha channel what matters</span>
<span class="k">def</span> <span class="nf">width</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
    <span class="k">return</span> <span class="mi">80</span> <span class="o">*</span> <span class="n">i</span> <span class="o">/</span> <span class="mf">49.0</span>
<span class="n">points</span> <span class="o">=</span> <span class="p">{</span><span class="n">width</span><span class="p">(</span><span class="n">i</span><span class="p">):</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">width</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1</span><span class="o">/</span><span class="mf">10.0</span><span class="p">)]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">50</span><span class="p">)}</span>
<span class="n">colormap</span><span class="o">.</span><span class="n">setPoints</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
<span class="n">minicolumn</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">rtneuron</span><span class="o">.</span><span class="n">RepresentationMode</span><span class="o">.</span><span class="n">NO_AXON</span>
<span class="n">minicolumn</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">colormaps</span><span class="o">.</span><span class="n">by_width</span> <span class="o">=</span> <span class="n">colormap</span>
<span class="n">minicolumn</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
<span class="n">player</span><span class="o">.</span><span class="n">timestamp</span> <span class="o">=</span> <span class="mi">6</span>
<span class="n">rtneuron</span><span class="o">.</span><span class="n">snapshot_to_notebook</span><span class="p">(</span><span class="n">view</span><span class="p">)</span>
</pre></div>
</div>
<img alt="_images/simulation_playback_15_0.png" src="_images/simulation_playback_15_0.png" />
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="n">player</span><span class="o">.</span><span class="n">timestamp</span> <span class="o">=</span> <span class="n">player</span><span class="o">.</span><span class="n">window</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">player</span><span class="o">.</span><span class="n">play</span><span class="p">()</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="n">player</span><span class="o">.</span><span class="n">pause</span><span class="p">()</span>
</pre></div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/simulation_playback.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">RTNeuron 3.0 Python API documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2016, Cajal Blue Brain BBP/EPFL.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.
    </div>
  </body>
</html>