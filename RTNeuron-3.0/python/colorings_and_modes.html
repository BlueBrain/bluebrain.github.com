<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Colorings and modes &mdash; RTNeuron 3.0 Python API documentation</title>
    
    <link rel="stylesheet" href="_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '3.0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="RTNeuron 3.0 Python API documentation" href="index.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">RTNeuron 3.0 Python API documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="colorings-and-modes">
<span id="id1"></span><h1>Colorings and modes<a class="headerlink" href="#colorings-and-modes" title="Permalink to this headline">Â¶</a></h1>
<p>The most immediate thing that can be done with the rtneuron module is to
display one test circuit. By default, only the somata are displayed,
using spheres to represent them, but this can be changed by provinding each
target as a tuple of the target key and the attribute dict.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">rtneuron</span>

<span class="c1"># Presetting the global variables for the default window size</span>
<span class="n">rtneuron</span><span class="o">.</span><span class="n">global_attributes</span><span class="o">.</span><span class="n">window_width</span> <span class="o">=</span> <span class="mi">800</span>
<span class="n">rtneuron</span><span class="o">.</span><span class="n">global_attributes</span><span class="o">.</span><span class="n">window_height</span> <span class="o">=</span> <span class="mi">1100</span>
<span class="k">if</span> <span class="s1">&#39;EQ_WINDOW_IATTR_HINT_FULLSCREEN&#39;</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
    <span class="k">del</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;EQ_WINDOW_IATTR_HINT_FULLSCREEN&#39;</span><span class="p">]</span>

<span class="c1"># By default, morphologies are loaded even in soma only mode to find out the soma radius.</span>
<span class="c1"># This can be disabled by uncommenting the line below.</span>
<span class="c1"># rtneuron.default_scene_attributes.load_morphologies = False</span>

<span class="c1">#blueconfig = &quot;/gpfs/bbp.cscs.ch/release/l2/2012.07.23/circuit/O1/merged_circuit/CircuitConfig&quot;</span>
<span class="n">blueconfig</span> <span class="o">=</span> <span class="s2">&quot;/gpfs/bbp.cscs.ch/project/proj3/resources/circuits/ReleaseL2_fixed&quot;</span>
<span class="n">rtneuron</span><span class="o">.</span><span class="n">display_circuit</span><span class="p">(</span><span class="n">blueconfig</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;mc2_Column&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="n">rtneuron</span><span class="o">.</span><span class="n">RepresentationMode</span><span class="o">.</span><span class="n">SOMA</span><span class="p">}))</span>
<span class="n">view</span> <span class="o">=</span> <span class="n">rtneuron</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">views</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">view</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">background</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">scene</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">scene</span>
<span class="n">simulation</span> <span class="o">=</span> <span class="n">rtneuron</span><span class="o">.</span><span class="n">simulation</span>
<span class="n">rtneuron</span><span class="o">.</span><span class="n">snapshot_to_notebook</span><span class="p">(</span><span class="n">view</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span></span>Trying to load blue config: /home/hernando/bbp/data/blue.cfg... done
Creating 10000 neurons
0%   10   20   30   40   50   60   70   80   90   100%
|----|----|----|----|----|----|----|----|----|----|
***************************************************
Adding 10000 neurons to the scene
0%   10   20   30   40   50   60   70   80   90   100%
|----|----|----|----|----|----|----|----|----|----|
***************************************************
</pre></div>
</div>
<img alt="_images/colorings_and_modes_1_0.png" src="_images/colorings_and_modes_1_0.png" />
<p>Using the handler object that represents all the neurons added to the
scene we can, for example, change the color of the neurons. This
property is accessed through the <em>attributes</em> member of the handler.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="n">all_neurons</span> <span class="o">=</span> <span class="n">scene</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">all_neurons</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">all_neurons</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
<span class="n">rtneuron</span><span class="o">.</span><span class="n">snapshot_to_notebook</span><span class="p">(</span><span class="n">view</span><span class="p">)</span>
</pre></div>
</div>
<img alt="_images/colorings_and_modes_3_0.png" src="_images/colorings_and_modes_3_0.png" />
<p>Now we will obtain the list of cell IDs of each layer. Each layer has a
<em>target</em> name associated with it. There are <em>targets</em> also for other
circuit subsets. The targets for layers are queried from the simulation.
The ids are used to query subsets of the scene object that represents
the whole circuit. Each query returns a handler that can be used to
modify the attributes of the subset it represents. The list of ids of
each query may overlap. In this case, the properties of the last handler
applied prevail.</p>
<p>In this case we are going to change the color of each layer.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="n">layer_ids</span> <span class="o">=</span><span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">):</span>
    <span class="n">layer_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">simulation</span><span class="o">.</span><span class="n">gids</span><span class="p">(</span><span class="s1">&#39;Layer</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">i</span><span class="p">))</span>


<span class="n">layers</span> <span class="o">=</span> <span class="p">[</span><span class="n">all_neurons</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">ids</span><span class="p">)</span> <span class="k">for</span> <span class="n">ids</span> <span class="ow">in</span> <span class="n">layer_ids</span><span class="p">]</span>
<span class="n">colors</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
          <span class="p">[</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]</span>
<span class="k">for</span> <span class="n">layer</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">layers</span><span class="p">,</span> <span class="n">colors</span><span class="p">):</span>
    <span class="n">layer</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="n">color</span>
    <span class="n">layer</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
<span class="n">rtneuron</span><span class="o">.</span><span class="n">snapshot_to_notebook</span><span class="p">(</span><span class="n">view</span><span class="p">)</span>
</pre></div>
</div>
<img alt="_images/colorings_and_modes_5_0.png" src="_images/colorings_and_modes_5_0.png" />
<p>It is possible to modify the representation of neurons dynamically, for
example to show the full morphology of selected neurons. Data will be
loaded on demand as needed.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="n">ids</span> <span class="o">=</span> <span class="n">simulation</span><span class="o">.</span><span class="n">gids</span><span class="p">(</span><span class="s1">&#39;mc2_MiniColumn_0&#39;</span><span class="p">)</span>
<span class="n">minicolumn</span> <span class="o">=</span> <span class="n">all_neurons</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">ids</span><span class="p">)</span>
<span class="n">minicolumn</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">rtneuron</span><span class="o">.</span><span class="n">RepresentationMode</span><span class="o">.</span><span class="n">WHOLE_NEURON</span>
<span class="n">minicolumn</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
<span class="n">rtneuron</span><span class="o">.</span><span class="n">snapshot_to_notebook</span><span class="p">(</span><span class="n">view</span><span class="p">)</span>
</pre></div>
</div>
<img alt="_images/colorings_and_modes_7_0.png" src="_images/colorings_and_modes_7_0.png" />
<p>After enabling transparency on the scene we can modify the alpha channel
of the colors to make the neurons outside our target of interest less
visible.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="n">rtneuron</span><span class="o">.</span><span class="n">sceneops</span><span class="o">.</span><span class="n">enable_transparency</span><span class="p">(</span><span class="n">scene</span><span class="p">)</span>
<span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="n">layers</span><span class="p">:</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">color</span>
    <span class="c1"># layer.attributes.color[3] = 0.2 won&#39;t work as expected. Without getting</span>
    <span class="c1"># into too many details, AttributeMap is special in the sense that attributes.color</span>
    <span class="c1"># creates a temporary variable, so to change the color you have to reset it.</span>
    <span class="n">c</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.05</span>
    <span class="n">layer</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="n">c</span>
    <span class="n">layer</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
<span class="c1"># The layers overlap with minicolumn, so it becomes dirty. Calling update resets</span>
<span class="c1"># its attributes.</span>
<span class="n">minicolumn</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
<span class="n">rtneuron</span><span class="o">.</span><span class="n">snapshot_to_notebook</span><span class="p">(</span><span class="n">view</span><span class="p">)</span>
</pre></div>
</div>
<img alt="_images/colorings_and_modes_9_0.png" src="_images/colorings_and_modes_9_0.png" />
<p>We can also display axon and dendrites with different colors or display
only the dendrites of specific cells.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="n">minicolumn</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">minicolumn</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">secondary_color</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">minicolumn</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">color_scheme</span> <span class="o">=</span> <span class="n">rtneuron</span><span class="o">.</span><span class="n">ColorScheme</span><span class="o">.</span><span class="n">BY_BRANCH_TYPE</span>
<span class="n">minicolumn</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
<span class="n">rtneuron</span><span class="o">.</span><span class="n">snapshot_to_notebook</span><span class="p">(</span><span class="n">view</span><span class="p">)</span>
</pre></div>
</div>
<img alt="_images/colorings_and_modes_11_0.png" src="_images/colorings_and_modes_11_0.png" />
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="n">minicolumn</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">rtneuron</span><span class="o">.</span><span class="n">RepresentationMode</span><span class="o">.</span><span class="n">NO_AXON</span>
<span class="n">minicolumn</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
<span class="n">rtneuron</span><span class="o">.</span><span class="n">snapshot_to_notebook</span><span class="p">(</span><span class="n">view</span><span class="p">)</span>
</pre></div>
</div>
<img alt="_images/colorings_and_modes_12_0.png" src="_images/colorings_and_modes_12_0.png" />
<p>Another option is to color the branches according to the value of some
property. The currently supported modes are coloring by distance to soma
and by branch width.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">math</span>
<span class="n">colormap</span> <span class="o">=</span> <span class="n">rtneuron</span><span class="o">.</span><span class="n">ColorMap</span><span class="p">()</span>
<span class="c1"># The following colormap is a non linear function that mimics light attenuation based on an absortion</span>
<span class="c1"># coefficient. The final images are not phisically correct because the attenuation is visualized as</span>
<span class="c1"># if branches were perpendicular to light rays, but gives a good result.</span>
<span class="n">absortion_coeff</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">points</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="n">max_width</span> <span class="o">=</span> <span class="mi">80</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">50</span><span class="p">):</span>
    <span class="n">width</span> <span class="o">=</span> <span class="n">max_width</span> <span class="o">*</span> <span class="n">i</span> <span class="o">/</span> <span class="mf">49.0</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">width</span> <span class="o">*</span> <span class="mi">1</span><span class="o">/</span><span class="n">absortion_coeff</span><span class="p">)</span>
    <span class="n">points</span><span class="p">[</span><span class="n">width</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">alpha</span> <span class="o">*</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">alpha</span><span class="p">]</span>
<span class="n">colormap</span><span class="o">.</span><span class="n">setPoints</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>

<span class="n">minicolumn</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">colormaps</span> <span class="o">=</span> <span class="n">rtneuron</span><span class="o">.</span><span class="n">AttributeMap</span><span class="p">()</span>
<span class="n">minicolumn</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">colormaps</span><span class="o">.</span><span class="n">by_width</span> <span class="o">=</span> <span class="n">colormap</span>
<span class="n">minicolumn</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">color_scheme</span> <span class="o">=</span> <span class="n">rtneuron</span><span class="o">.</span><span class="n">ColorScheme</span><span class="o">.</span><span class="n">BY_WIDTH</span>
<span class="n">minicolumn</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
<span class="n">rtneuron</span><span class="o">.</span><span class="n">snapshot_to_notebook</span><span class="p">(</span><span class="n">view</span><span class="p">)</span>
</pre></div>
</div>
<img alt="_images/colorings_and_modes_14_0.png" src="_images/colorings_and_modes_14_0.png" />
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/colorings_and_modes.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">RTNeuron 3.0 Python API documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2016, Cajal Blue Brain BBP/EPFL.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.
    </div>
  </body>
</html>