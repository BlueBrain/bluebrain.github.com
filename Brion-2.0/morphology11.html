<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>Brion: Implementing Morphology version 1.1, support for glia cells</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Brion
   &#160;<span id="projectnumber">2.0.0</span>
   </div>
   <div id="projectbrief">The Blue Brain C++ I/O library</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('morphology11.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Implementing Morphology version 1.1, support for glia cells </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The current morphology version 1 specification and implementation is tailored for neuronal cells. The support for glia does imply only some changes and will be backward compatible to version 1, hence version 1.1.</p>
<h2>Requirements</h2>
<ul>
<li>Backward-compatibility with version 1</li>
<li>Support for glia cells according to <a href="https://bbpcode.epfl.ch/code/#/c/22473/20/source/h5v1.rst">specification</a>:<ul>
<li>new 'cell_family' HDF5 enum which has the one of the values NEURON or GLIA</li>
<li>new glia cell values for brion::SectionType: 'glia process', 'glia endfoot'</li>
<li>new 'perimeters' dataset</li>
</ul>
</li>
<li>New metadata dataset containing provenance and versioning information:<ul>
<li>'creator': The software used to create the morphology.</li>
<li>'software_version': major.minor.patch.sha1 of the software that wrote the file</li>
<li>'creation_time': date &amp; time when the file was written</li>
<li>'version': An attribute array of two U32LE integers that stores the major and minor version numbers.</li>
</ul>
</li>
</ul>
<h2>New dependencies</h2>
<p>None</p>
<h2>API</h2>
<h3>Additions</h3>
<pre class="fragment">SectionTypes
{
    // after existing ones for neurons
    SECTION_GLIA_PROCESS = 2,
    SECTION_GLIA_ENDFOOT = 3,
    // ...
};

MorphologyVersion
{
    // between existing ones
    MORPHOLOGY_VERSION_H5_1 = 1,
    MORPHOLOGY_VERSION_H5_2 = 2,
    MORPHOLOGY_VERSION_H5_1_1 = 3,
    // ...
};

class Morphology
    // Default parameter brion::MorphologyRepairStage for all functions to
    // brion::MORPHOLOGY_UNDEFINED. Needed only for V2 and throws there if
    // brion::MORPHOLOGY_UNDEFINED.
</pre><h3>New</h3>
<pre class="fragment">/** The cell family represented by brion::Morphology. */
CellFamily
{
    FAMILY_NEURON = 0,
    FAMILY_GLIA = 1
};

class Morphology
{
    ...
    /**
     * Open the given morphology file for write access.
     *
     * @param file filename of the output morphology file
     * @param family the cell family that this morphology represents.
     */
    Morphology( const std::string&amp; file, CellFamily family );

    /** @return the cell family of that morphology. */
    CellFamily brion::getCellFamily() const;

    /**
     * @return perimeters of the cross sections for each point of the
     *         morphology in micrometers.
     * @throw std::runtime_error if empty for FAMILY_GLIA
     */
    floatsPtr readPerimeters() const;

    /**
     * Write perimeters of morphology.
     *
     * @param perimeters perimeters of the cross sections for each point of
     *                   the morphology in micrometers
     * @throw std::runtime_error if object not created with write ctor
     * @throw std::runtime_error if not supported by implementation
     */
    void writePerimeters( const floats&amp; perimeters );
</pre><h2>File format</h2>
<ul>
<li>new root dataset 'perimeters' with dimension 1 and datatype H5::NATIVE_FLOAT</li>
<li>new root group 'metadata'</li>
<li>new enum 'cell_family_enum' with datatype H5::NATIVE_INT and values NEURON=0 and GLIA=1 inside 'metadata'</li>
<li>new attribute 'cell_family' with datatype 'cell_family_enum' inside 'metadata'</li>
<li>new attributes 'creator', 'software_version', 'creation_time' with datatype H5::C_S1 (string) inside 'metadata'</li>
<li>new attribute 'version' with datatype H5::STD_U32LE and dimensionality 2 inside 'metadata'</li>
</ul>
<h2>Examples</h2>
<pre class="fragment">brion::Morphology glia( "glia.h5", brion::FAMILY_GLIA );
glia.writePoints( points );
glia.writeSections( sections );
glia.writeSectionTypes( types );
glia.writePerimeters( perimeters );

const brion::Morphology gliaRead( "glia.h5" );
BOOST_CHECK_EQUAL( gliaRead.getCellFamily(), brion::FAMILY_GLIA );

brion::Morphology neuron( "neuron.h5", brion::FAMILY_NEURON );
neuron.writePoints( points );
neuron.writeSections( sections );
neuron.writeSectionTypes( types );
neuron.writePerimeters( perimeters );

const brion::Morphology neuronRead( "neuron.h5" );
BOOST_CHECK_EQUAL( neuronRead.getCellFamily(), brion::FAMILY_NEURON );
</pre><h2>Issues</h2>
<h3>1: Do we choose cell family automatically or do we require an explicit selection?</h3>
<p>_Resolved: Explicit selection</p>
<p>As the perimeters can also be optionally used for the neuron cell family, a new constructor for writing morphologies enforces to explicitly choose the cell family.</p>
<h3>2. Why is the metadata not exposed in the API?</h3>
<p>_Resolved: No use case at the moment</p>
<p>From current use cases it is not needed to query the metadata programmatically. It will be used internally to verify validity of files while loading them. The user can check the metadata values by using <em>h5dump</em>. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="rfcs.html">RFCs</a></li>
    <li class="footer">Generated on Thu Mar 23 2017 06:06:09 for Brion by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.11 </li>
  </ul>
</div>
</body>
</html>
